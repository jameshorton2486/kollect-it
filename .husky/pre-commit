#!/bin/sh
# Husky pre-commit: block committing forbidden directories
# Shell script (sh), not PowerShell

# Source Husky helper if present
HUSKY_SH="$(dirname "$0")/_/husky.sh"
if [ -f "$HUSKY_SH" ]; then
  . "$HUSKY_SH"
fi

echo "Pre-commit repo safety check..."

# Check staged files instead of directory existence
FORBIDDEN_PATTERNS=".next/ .idea/ .venv/ .vercel/ node_modules/"

for pattern in $FORBIDDEN_PATTERNS; do
  if git diff --cached --name-only | grep -q "^$pattern"; then
    echo "ERROR: Files in $pattern must not be committed"
    exit 1
  fi
done

echo "Repo safe to commit"
